<div class="container">
<div ng-view></div>
</div>
<script>

var WebUI = angular.module('WebUI', ['ngResource', 'partials/list.html', 'partials/board.html'])
.config(['\$routeProvider', function(\$routeProvider) {
	\$routeProvider
	.when('/board', {templateUrl: 'partials/list.html', controller: List_Ctrl})
	.when('/board/:board_id', {templateUrl: 'partials/board.html', controller: Board_Ctrl})
	.otherwise({redirectTo: '/board'});
}]);

WebUI.factory("DB_Service", function(\$rootScope, \$resource) {
	var db = \$resource('/db/:db/:id', {}, {
		get: {method: 'GET'},
		get_all: {method: 'GET', params: {id: ''}}
	});

	var boardkeys = [];
	var boards = db.get_all({db: "boards"}, function (){
		for (var key in boards) {
			if (key.substr(0,1) != '\$') {
				boardkeys.push(key);
			}
		}
	});
	var postkeys = [];
	var posts = db.get_all({db: "posts"}, function (){
		for (var key in posts) {
			if (key.substr(0,1) != '\$') {
				postkeys.push(key);
			}
		}
	});

	return {
		boards: boards,
		boardkeys: boardkeys,
		posts: posts,
		postkeys: postkeys,
	}
});

angular.module("partials/list.html", []).run(["\$templateCache", function(\$templateCache) {
  \$templateCache.put("partials/list.html",
'<ul class="breadcrumb">' +
'  <li class="active">Boards</li>' +
'</ul>' +
'<table class="table table-striped">' +
'<tr>' +
'	<th>Board</th>' +
'	<th width="12.5%" style="text-align: center">Topics</th>' +
'	<th width="12.5%" style="text-align: center">Posts</th>' +
'	<th width="25%">Last Post</th>' +
'</tr>' +
'<tr ng-repeat="board in boardkeys">' + /* TODO figure out how to get the board id */
'	<td><a href="/board/#/board/{{board}}">{{boards[board].name}}</a><br />{{boards[board].description}}</td>' +
'	<td style="text-align: center">1</td>' +
'	<td style="text-align: center">2</td>' +
'	<td><a href="/board/#/topic/">Lost Kitty</a><br />Joe User - 22 min ago</td>' +
'</tr>' +
'</table>'
)}]);

function List_Ctrl(\$scope, DB_Service) {
	\$scope.boards = DB_Service.boards;
	\$scope.boardkeys = DB_Service.boardkeys;
	\$scope.posts = DB_Service.posts;
}

angular.module("partials/board.html", []).run(["\$templateCache", function(\$templateCache) {
  \$templateCache.put("partials/board.html",
'<ul class="breadcrumb">' +
'  <li><a href="#">Boards</li>' +
'  <li><a href="#">Boards</li>' +
'  <li class="active">poop</li>' +
/*'  <li class="active">poop</li>{{boards[board_id].name}}' +*/
'</ul>' +
'<div class="container">' +
'<table class="table table-striped">' +
'<tr>' +
'	<th>Post</th>' +
'	<th width="12.5%" style="text-align: center">Replies</th>' +
'	<th width="12.5%" style="text-align: center">Views</th>' +
'	<th width="25%">Last Post</th>' +
'</tr>' +
'<tr>' +
'	<td><a href="/board/#/topic/1">Lost Kitty</a><br />by Richard User - 30 min ago</td>' +
'	<td style="text-align: center">1</td>' +
'	<td style="text-align: center">5</td>' +
'	<td><a href="/board/#/topic/1">Lost Kitty</a><br />by Joe User - 22 min ago</td>' +
'</tr>' +
'</table>' +
'</div>'
)}]);

function Board_Ctrl(\$scope, DB_Service, \$routeParams) {
	\$scope.boards = DB_Service.boards;
	\$scope.posts = DB_Service.posts;
	\$scope.board_id = \$routeParams.board_id;
}

</script>
<!-- vim: filetype=html
-->
